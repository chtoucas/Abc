<Project>

  <!-- Global context -->
  <PropertyGroup>
    <ContinuousIntegrationBuild Condition=" '$(ContinuousIntegrationBuild)' == '' ">false</ContinuousIntegrationBuild>
    <ContinuousIntegrationBuild Condition=" '$(GITHUB_ACTIONS)' == 'true' ">true</ContinuousIntegrationBuild>
    <ContinuousIntegrationBuild Condition=" '$(TF_BUILD)' == 'true' ">true</ContinuousIntegrationBuild>
  </PropertyGroup>

  <!-- Repository layout -->
  <PropertyGroup>
    <RepositoryRoot>$(MSBuildThisFileDirectory)</RepositoryRoot>
    <SourceRoot>$(RepositoryRoot)src\</SourceRoot>
    <ArtifactsRoot>$(RepositoryRoot)__\</ArtifactsRoot>
  </PropertyGroup>

  <!-- Common settings -->
  <PropertyGroup>
    <DefaultTargetFramework>netcoreapp3.1</DefaultTargetFramework>

    <RootNamespace>Abc</RootNamespace>

    <LangVersion>latest</LangVersion>
    <Nullable>enable</Nullable>

    <GenerateDocumentationFile>false</GenerateDocumentationFile>

    <SignAssembly>true</SignAssembly>
    <AssemblyOriginatorKeyFile>$(MSBuildThisFileDirectory)Abc.snk</AssemblyOriginatorKeyFile>

    <DefineConstants>$(DefineConstants);CONTRACTS_FULL</DefineConstants>
    <DefineConstants>$(DefineConstants);INTERNAL_NULLABLE_ATTRIBUTES</DefineConstants>
    <DefineConstants Condition=" '$(SignAssembly)' == 'true' ">$(DefineConstants);SIGNED_ASSEMBLY</DefineConstants>

    <Authors>Chtoucas</Authors>
    <Company>Narvalo.Org</Company>
    <Product>Abécédaire Library</Product>
    <Copyright>Copyright (c) 2019 Narvalo.Org</Copyright>

    <RepositoryType>git</RepositoryType>
    <RepositoryUrl>https://github.com/chtoucas/Abc/</RepositoryUrl>
    <PackageReleaseNotes>See CHANGELOG in project root.</PackageReleaseNotes>

    <VersionPrefix>0.0.0</VersionPrefix>
    <VersionSuffix>DUMMY</VersionSuffix>

    <IsPackable>false</IsPackable>
    <PackageProjectUrl>$(RepositoryUrl)</PackageProjectUrl>
    <PackageLicenseExpression>BSD-3-Clause</PackageLicenseExpression>

    <!--
      We don't publish a package locally, we use PackageOutputPath.
      If the behaviour of nuget.exe changes (it has in the past), we will have
      to re-enable "eng\make-utilities.ps1 push" and update "LocalNuGetSource"
      accordingly:
        <LocalNuGetSource>$(ArtifactsRoot)nuget-feed\</LocalNuGetSource>
      TODO:
      - clear cache.
      - RestoreIgnoreFailedSources for when "nuget-cache" does not exist?
      - publish to myget or GitHub?
    -->
    <PackageOutputPath>$(ArtifactsRoot)packages\</PackageOutputPath>

    <LocalNuGetSource>$(PackageOutputPath)</LocalNuGetSource>
    <LocalNuGetCache>$(ArtifactsRoot)nuget-cache\</LocalNuGetCache>

    <RestoreAdditionalProjectSources>$(LocalNuGetSource)</RestoreAdditionalProjectSources>
    <RestoreAdditionalProjectFallbackFolders>$(LocalNuGetCache)</RestoreAdditionalProjectFallbackFolders>
  </PropertyGroup>

  <!-- Release vs Debug -->
  <Choose>
    <When Condition=" $(Configuration) == 'Release' ">
      <PropertyGroup>
        <CheckForOverflowUnderflow>false</CheckForOverflowUnderflow>

        <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
        <WarningsNotAsErrors />
      </PropertyGroup>
    </When>

    <Otherwise>
      <PropertyGroup>
        <CheckForOverflowUnderflow>true</CheckForOverflowUnderflow>

        <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
        <TreatSpecificWarningsAsErrors />
      </PropertyGroup>
    </Otherwise>
  </Choose>

</Project>
